{% extends "base.html" %}

{% block title %}Search Job{% endblock %}

{% block head %}
<style>
    .search-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    
    .search-field {
        width: 30%;
    }
    
    .search-button {
        text-align: center;
        margin: 20px 0;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }
    
    .data-table th, .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    
    .data-table th {
        background-color: #f2f2f2;
        cursor: pointer;
    }
    
    .data-table th:hover {
        background-color: #e0e0e0;
    }
    
    .data-table tr:hover {
        background-color: #f5f5f5;
    }
    
    .sortable::after {
        content: "▼";
        margin-left: 5px;
        font-size: 0.8em;
        opacity: 0.5;
    }
    
    .sortable.asc::after {
        content: "▲";
        opacity: 1;
    }
    
    .sortable.desc::after {
        content: "▼";
        opacity: 1;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tableHeaders = document.querySelectorAll('.sortable');
        
        tableHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const sortBy = this.getAttribute('data-sort');
                let sortDir = 'asc';
                
                // Alternar dirección de ordenamiento
                if (this.classList.contains('asc')) {
                    sortDir = 'desc';
                } else if (this.classList.contains('desc')) {
                    sortDir = 'asc';
                }
                
                // Redirigir con parámetros de ordenamiento
                window.location.href = `/search_job?sort_by=${sortBy}&sort_dir=${sortDir}`;
            });
        });
    });
</script>
{% endblock %}

{% block content %}
    <h1>Search Job</h1>
    
    <form method="POST">
        <div class="search-container">
            <div class="search-field">
                <p>Choose a country:</p>
                <select name="country" style="width: 100%;">
                    <option value="">All Countries</option>
                    {% for country in countries %}
                        <option value="{{ country }}">{{ country }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="search-field">
                <p>Choose a work area:</p>
                <select name="area" style="width: 100%;">
                    <option value="">All Areas</option>
                    {% for area in job_areas %}
                        <option value="{{ area }}">{{ area }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="search-field">
                <p>Choose some keywords for the job you want:</p>
                <input type="text" name="keywords" style="width: 100%;" placeholder="Enter keywords...">
            </div>
        </div>
        
        <div class="search-button">
            <input type="submit" value="Search">
        </div>
    </form>
    
    {% if results %}
        <h2>Search Results</h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th class="sortable {{ 'asc' if sort_by == 'country' and sort_dir == 'asc' else 'desc' if sort_by == 'country' and sort_dir == 'desc' else '' }}" data-sort="country">Country</th>
                    <th class="sortable {{ 'asc' if sort_by == 'company' and sort_dir == 'asc' else 'desc' if sort_by == 'company' and sort_dir == 'desc' else '' }}" data-sort="company">Company</th>
                    <th class="sortable {{ 'asc' if sort_by == 'area' and sort_dir == 'asc' else 'desc' if sort_by == 'area' and sort_dir == 'desc' else '' }}" data-sort="area">Area</th>
                    <th class="sortable {{ 'asc' if sort_by == 'job_title' and sort_dir == 'asc' else 'desc' if sort_by == 'job_title' and sort_dir == 'desc' else '' }}" data-sort="job_title">Job Title</th>
                    <th class="sortable {{ 'asc' if sort_by == 'salary' and sort_dir == 'asc' else 'desc' if sort_by == 'salary' and sort_dir == 'desc' else '' }}" data-sort="salary">Mean Monthly Salary</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <td>{{ result[0] }}</td>
                    <td>{{ result[1] }}</td>
                    <td>{{ result[2] }}</td>
                    <td>{{ result[3] }}</td>
                    <td>${{ "%.2f"|format(result[4]) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}
